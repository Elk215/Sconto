<?php return array (
  'preserve_keys' => true,
  'update_object' => true,
  'vehicle_package' => 'transport',
  'vehicle_class' => 'xPDOObjectVehicle',
  'guid' => '1017176167c889575fd374a64b022e42',
  'package' => 'modx',
  'class' => 'modSnippet',
  'signature' => 'af77f53849e86fb8e8e3cbd66f412e7e',
  'native_key' => 41,
  'object' => '{"id":41,"source":1,"property_preprocess":0,"name":"msCart","description":"","editor_type":0,"category":11,"cache_type":0,"snippet":"\\/** @var modX $modx *\\/\\r\\n\\/** @var array $scriptProperties *\\/\\r\\n\\/** @var miniShop2 $miniShop2 *\\/\\r\\n$miniShop2 = $modx->getService(\'miniShop2\');\\r\\n$miniShop2->initialize($modx->context->key);\\r\\n\\/** @var pdoFetch $pdoFetch *\\/\\r\\nif (!$modx->loadClass(\'pdofetch\', MODX_CORE_PATH . \'components\\/pdotools\\/model\\/pdotools\\/\', false, true)) {\\r\\n    return false;\\r\\n}\\r\\n$pdoFetch = new pdoFetch($modx, $scriptProperties);\\r\\n$pdoFetch->addTime(\'pdoTools loaded.\');\\r\\n\\r\\n$tpl = $modx->getOption(\'tpl\', $scriptProperties, \'tpl.msCart\');\\r\\n$cart = $miniShop2->cart->get();\\r\\n$status = $miniShop2->cart->status();\\r\\n\\r\\n\\/\\/ Do not show empty cart when displaying order details\\r\\nif (!empty($_GET[\'msorder\'])) {\\r\\n    return \'\';\\r\\n} elseif (empty($status[\'total_count\'])) {\\r\\n    return $pdoFetch->getChunk($tpl);\\r\\n}\\r\\n\\r\\n\\/\\/ Select cart products\\r\\n$where = array(\\r\\n    \'msProduct.id:IN\' => array(),\\r\\n);\\r\\nforeach ($cart as $entry) {\\r\\n    $where[\'msProduct.id:IN\'][] = $entry[\'id\'];\\r\\n}\\r\\n$where[\'msProduct.id:IN\'] = array_unique($where[\'msProduct.id:IN\']);\\r\\n\\r\\n\\/\\/ Include products properties\\r\\n$leftJoin = array(\\r\\n    \'Data\' => array(\\r\\n        \'class\' => \'msProductData\',\\r\\n    ),\\r\\n    \'Vendor\' => array(\\r\\n        \'class\' => \'msVendor\',\\r\\n        \'on\' => \'Data.vendor = Vendor.id\',\\r\\n    ),\\r\\n);\\r\\n\\r\\n\\/\\/ Select columns\\r\\n$select = array(\\r\\n    \'msProduct\' => !empty($includeContent)\\r\\n        ? $modx->getSelectColumns(\'msProduct\', \'msProduct\')\\r\\n        : $modx->getSelectColumns(\'msProduct\', \'msProduct\', \'\', array(\'content\'), true),\\r\\n    \'Data\' => $modx->getSelectColumns(\'msProductData\', \'Data\', \'\', array(\'id\'), true),\\r\\n    \'Vendor\' => $modx->getSelectColumns(\'msVendor\', \'Vendor\', \'vendor.\', array(\'id\'), true),\\r\\n);\\r\\n\\r\\n\\/\\/ Include products thumbnails\\r\\nif (!empty($includeThumbs)) {\\r\\n    $thumbs = array_map(\'trim\', explode(\',\', $includeThumbs));\\r\\n    if (!empty($thumbs[0])) {\\r\\n        foreach ($thumbs as $thumb) {\\r\\n            $leftJoin[$thumb] = array(\\r\\n                \'class\' => \'msProductFile\',\\r\\n                \'on\' => \\"`{$thumb}`.product_id = msProduct.id AND `{$thumb}`.parent != 0 AND `{$thumb}`.path LIKE \'%\\/{$thumb}\\/%\' AND `{$thumb}`.rank = 0\\",\\r\\n            );\\r\\n            $select[$thumb] = \\"`{$thumb}`.url as \'{$thumb}\'\\";\\r\\n        }\\r\\n        $pdoFetch->addTime(\'Included list of thumbnails: <b>\' . implode(\', \', $thumbs) . \'<\\/b>.\');\\r\\n    }\\r\\n}\\r\\n\\r\\n\\/\\/ Add user parameters\\r\\nforeach (array(\'where\', \'leftJoin\', \'select\') as $v) {\\r\\n    if (!empty($scriptProperties[$v])) {\\r\\n        $tmp = $scriptProperties[$v];\\r\\n        if (!is_array($tmp)) {\\r\\n            $tmp = json_decode($tmp, true);\\r\\n        }\\r\\n        if (is_array($tmp)) {\\r\\n            $$v = array_merge($$v, $tmp);\\r\\n        }\\r\\n    }\\r\\n    unset($scriptProperties[$v]);\\r\\n}\\r\\n$pdoFetch->addTime(\'Conditions prepared\');\\r\\n\\r\\n$default = array(\\r\\n    \'class\' => \'msProduct\',\\r\\n    \'where\' => $where,\\r\\n    \'leftJoin\' => $leftJoin,\\r\\n    \'select\' => $select,\\r\\n    \'sortby\' => \'msProduct.id\',\\r\\n    \'sortdir\' => \'ASC\',\\r\\n    \'groupby\' => \'msProduct.id\',\\r\\n    \'limit\' => 0,\\r\\n    \'return\' => \'data\',\\r\\n    \'nestedChunkPrefix\' => \'minishop2_\',\\r\\n);\\r\\n\\/\\/ Merge all properties and run!\\r\\n$pdoFetch->setConfig(array_merge($default, $scriptProperties), false);\\r\\n\\r\\n$tmp = $pdoFetch->run();\\r\\n$rows = array();\\r\\nforeach ($tmp as $row) {\\r\\n    $rows[$row[\'id\']] = $row;\\r\\n}\\r\\n\\r\\n\\/\\/ Process products in cart\\r\\n$products = array();\\r\\n$total = array(\'count\' => 0, \'weight\' => 0, \'cost\' => 0);\\r\\nforeach ($cart as $key => $entry) {\\r\\n    if (!isset($rows[$entry[\'id\']])) {\\r\\n        continue;\\r\\n    }\\r\\n    $product = $rows[$entry[\'id\']];\\r\\n\\r\\n    $product[\'key\'] = $key;\\r\\n    $product[\'count\'] = $entry[\'count\'];\\r\\n    $product[\'old_price\'] = $miniShop2->formatPrice(\\r\\n        $product[\'price\'] > $entry[\'price\']\\r\\n            ? $product[\'price\']\\r\\n            : $product[\'old_price\']\\r\\n    );\\r\\n    $product[\'price\'] = $miniShop2->formatPrice($entry[\'price\']);\\r\\n    $product[\'weight\'] = $miniShop2->formatWeight($entry[\'weight\']);\\r\\n    $product[\'cost\'] = $miniShop2->formatPrice($entry[\'count\'] * $entry[\'price\']);\\r\\n\\r\\n    \\/\\/ Additional properties of product in cart\\r\\n    if (!empty($entry[\'options\']) && is_array($entry[\'options\'])) {\\r\\n        $product[\'options\'] = $entry[\'options\'];\\r\\n        foreach ($entry[\'options\'] as $option => $value) {\\r\\n            $product[\'option.\' . $option] = $value;\\r\\n        }\\r\\n    }\\r\\n\\r\\n    \\/\\/ Add option values\\r\\n    $options = $modx->call(\'msProductData\', \'loadOptions\', array(&$modx, $product[\'id\']));\\r\\n    $products[] = array_merge($product, $options);\\r\\n\\r\\n    \\/\\/ Count total\\r\\n    $total[\'count\'] += $entry[\'count\'];\\r\\n    $total[\'cost\'] += $entry[\'count\'] * $entry[\'price\'];\\r\\n    $total[\'weight\'] += $entry[\'count\'] * $entry[\'weight\'];\\r\\n}\\r\\n$total[\'cost\'] = $miniShop2->formatPrice($total[\'cost\']);\\r\\n$total[\'weight\'] = $miniShop2->formatWeight($total[\'weight\']);\\r\\n\\r\\n$output = $pdoFetch->getChunk($tpl, array(\\r\\n    \'total\' => $total,\\r\\n    \'products\' => $products,\\r\\n));\\r\\n\\r\\nif ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {\\r\\n    $output .= \'<pre class=\\"msCartLog\\">\' . print_r($pdoFetch->getTime(), true) . \'<\\/pre>\';\\r\\n}\\r\\n\\r\\nif (!empty($toPlaceholder)) {\\r\\n    $modx->setPlaceholder($toPlaceholder, $output);\\r\\n} else {\\r\\n    return $output;\\r\\n}","locked":0,"properties":"a:5:{s:3:\\"tpl\\";a:7:{s:4:\\"name\\";s:3:\\"tpl\\";s:4:\\"desc\\";s:12:\\"ms2_prop_tpl\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:10:\\"tpl.msCart\\";s:7:\\"lexicon\\";s:20:\\"minishop2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:10:\\"includeTVs\\";a:7:{s:4:\\"name\\";s:10:\\"includeTVs\\";s:4:\\"desc\\";s:19:\\"ms2_prop_includeTVs\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:20:\\"minishop2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:13:\\"includeThumbs\\";a:7:{s:4:\\"name\\";s:13:\\"includeThumbs\\";s:4:\\"desc\\";s:22:\\"ms2_prop_includeThumbs\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:20:\\"minishop2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:13:\\"toPlaceholder\\";a:7:{s:4:\\"name\\";s:13:\\"toPlaceholder\\";s:4:\\"desc\\";s:22:\\"ms2_prop_toPlaceholder\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:20:\\"minishop2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:7:\\"showLog\\";a:7:{s:4:\\"name\\";s:7:\\"showLog\\";s:4:\\"desc\\";s:16:\\"ms2_prop_showLog\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:20:\\"minishop2:properties\\";s:4:\\"area\\";s:0:\\"\\";}}","moduleguid":"","static":0,"static_file":"core\\/components\\/minishop2\\/elements\\/snippets\\/snippet.ms_cart.php","content":"\\/** @var modX $modx *\\/\\r\\n\\/** @var array $scriptProperties *\\/\\r\\n\\/** @var miniShop2 $miniShop2 *\\/\\r\\n$miniShop2 = $modx->getService(\'miniShop2\');\\r\\n$miniShop2->initialize($modx->context->key);\\r\\n\\/** @var pdoFetch $pdoFetch *\\/\\r\\nif (!$modx->loadClass(\'pdofetch\', MODX_CORE_PATH . \'components\\/pdotools\\/model\\/pdotools\\/\', false, true)) {\\r\\n    return false;\\r\\n}\\r\\n$pdoFetch = new pdoFetch($modx, $scriptProperties);\\r\\n$pdoFetch->addTime(\'pdoTools loaded.\');\\r\\n\\r\\n$tpl = $modx->getOption(\'tpl\', $scriptProperties, \'tpl.msCart\');\\r\\n$cart = $miniShop2->cart->get();\\r\\n$status = $miniShop2->cart->status();\\r\\n\\r\\n\\/\\/ Do not show empty cart when displaying order details\\r\\nif (!empty($_GET[\'msorder\'])) {\\r\\n    return \'\';\\r\\n} elseif (empty($status[\'total_count\'])) {\\r\\n    return $pdoFetch->getChunk($tpl);\\r\\n}\\r\\n\\r\\n\\/\\/ Select cart products\\r\\n$where = array(\\r\\n    \'msProduct.id:IN\' => array(),\\r\\n);\\r\\nforeach ($cart as $entry) {\\r\\n    $where[\'msProduct.id:IN\'][] = $entry[\'id\'];\\r\\n}\\r\\n$where[\'msProduct.id:IN\'] = array_unique($where[\'msProduct.id:IN\']);\\r\\n\\r\\n\\/\\/ Include products properties\\r\\n$leftJoin = array(\\r\\n    \'Data\' => array(\\r\\n        \'class\' => \'msProductData\',\\r\\n    ),\\r\\n    \'Vendor\' => array(\\r\\n        \'class\' => \'msVendor\',\\r\\n        \'on\' => \'Data.vendor = Vendor.id\',\\r\\n    ),\\r\\n);\\r\\n\\r\\n\\/\\/ Select columns\\r\\n$select = array(\\r\\n    \'msProduct\' => !empty($includeContent)\\r\\n        ? $modx->getSelectColumns(\'msProduct\', \'msProduct\')\\r\\n        : $modx->getSelectColumns(\'msProduct\', \'msProduct\', \'\', array(\'content\'), true),\\r\\n    \'Data\' => $modx->getSelectColumns(\'msProductData\', \'Data\', \'\', array(\'id\'), true),\\r\\n    \'Vendor\' => $modx->getSelectColumns(\'msVendor\', \'Vendor\', \'vendor.\', array(\'id\'), true),\\r\\n);\\r\\n\\r\\n\\/\\/ Include products thumbnails\\r\\nif (!empty($includeThumbs)) {\\r\\n    $thumbs = array_map(\'trim\', explode(\',\', $includeThumbs));\\r\\n    if (!empty($thumbs[0])) {\\r\\n        foreach ($thumbs as $thumb) {\\r\\n            $leftJoin[$thumb] = array(\\r\\n                \'class\' => \'msProductFile\',\\r\\n                \'on\' => \\"`{$thumb}`.product_id = msProduct.id AND `{$thumb}`.parent != 0 AND `{$thumb}`.path LIKE \'%\\/{$thumb}\\/%\' AND `{$thumb}`.rank = 0\\",\\r\\n            );\\r\\n            $select[$thumb] = \\"`{$thumb}`.url as \'{$thumb}\'\\";\\r\\n        }\\r\\n        $pdoFetch->addTime(\'Included list of thumbnails: <b>\' . implode(\', \', $thumbs) . \'<\\/b>.\');\\r\\n    }\\r\\n}\\r\\n\\r\\n\\/\\/ Add user parameters\\r\\nforeach (array(\'where\', \'leftJoin\', \'select\') as $v) {\\r\\n    if (!empty($scriptProperties[$v])) {\\r\\n        $tmp = $scriptProperties[$v];\\r\\n        if (!is_array($tmp)) {\\r\\n            $tmp = json_decode($tmp, true);\\r\\n        }\\r\\n        if (is_array($tmp)) {\\r\\n            $$v = array_merge($$v, $tmp);\\r\\n        }\\r\\n    }\\r\\n    unset($scriptProperties[$v]);\\r\\n}\\r\\n$pdoFetch->addTime(\'Conditions prepared\');\\r\\n\\r\\n$default = array(\\r\\n    \'class\' => \'msProduct\',\\r\\n    \'where\' => $where,\\r\\n    \'leftJoin\' => $leftJoin,\\r\\n    \'select\' => $select,\\r\\n    \'sortby\' => \'msProduct.id\',\\r\\n    \'sortdir\' => \'ASC\',\\r\\n    \'groupby\' => \'msProduct.id\',\\r\\n    \'limit\' => 0,\\r\\n    \'return\' => \'data\',\\r\\n    \'nestedChunkPrefix\' => \'minishop2_\',\\r\\n);\\r\\n\\/\\/ Merge all properties and run!\\r\\n$pdoFetch->setConfig(array_merge($default, $scriptProperties), false);\\r\\n\\r\\n$tmp = $pdoFetch->run();\\r\\n$rows = array();\\r\\nforeach ($tmp as $row) {\\r\\n    $rows[$row[\'id\']] = $row;\\r\\n}\\r\\n\\r\\n\\/\\/ Process products in cart\\r\\n$products = array();\\r\\n$total = array(\'count\' => 0, \'weight\' => 0, \'cost\' => 0);\\r\\nforeach ($cart as $key => $entry) {\\r\\n    if (!isset($rows[$entry[\'id\']])) {\\r\\n        continue;\\r\\n    }\\r\\n    $product = $rows[$entry[\'id\']];\\r\\n\\r\\n    $product[\'key\'] = $key;\\r\\n    $product[\'count\'] = $entry[\'count\'];\\r\\n    $product[\'old_price\'] = $miniShop2->formatPrice(\\r\\n        $product[\'price\'] > $entry[\'price\']\\r\\n            ? $product[\'price\']\\r\\n            : $product[\'old_price\']\\r\\n    );\\r\\n    $product[\'price\'] = $miniShop2->formatPrice($entry[\'price\']);\\r\\n    $product[\'weight\'] = $miniShop2->formatWeight($entry[\'weight\']);\\r\\n    $product[\'cost\'] = $miniShop2->formatPrice($entry[\'count\'] * $entry[\'price\']);\\r\\n\\r\\n    \\/\\/ Additional properties of product in cart\\r\\n    if (!empty($entry[\'options\']) && is_array($entry[\'options\'])) {\\r\\n        $product[\'options\'] = $entry[\'options\'];\\r\\n        foreach ($entry[\'options\'] as $option => $value) {\\r\\n            $product[\'option.\' . $option] = $value;\\r\\n        }\\r\\n    }\\r\\n\\r\\n    \\/\\/ Add option values\\r\\n    $options = $modx->call(\'msProductData\', \'loadOptions\', array(&$modx, $product[\'id\']));\\r\\n    $products[] = array_merge($product, $options);\\r\\n\\r\\n    \\/\\/ Count total\\r\\n    $total[\'count\'] += $entry[\'count\'];\\r\\n    $total[\'cost\'] += $entry[\'count\'] * $entry[\'price\'];\\r\\n    $total[\'weight\'] += $entry[\'count\'] * $entry[\'weight\'];\\r\\n}\\r\\n$total[\'cost\'] = $miniShop2->formatPrice($total[\'cost\']);\\r\\n$total[\'weight\'] = $miniShop2->formatWeight($total[\'weight\']);\\r\\n\\r\\n$output = $pdoFetch->getChunk($tpl, array(\\r\\n    \'total\' => $total,\\r\\n    \'products\' => $products,\\r\\n));\\r\\n\\r\\nif ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {\\r\\n    $output .= \'<pre class=\\"msCartLog\\">\' . print_r($pdoFetch->getTime(), true) . \'<\\/pre>\';\\r\\n}\\r\\n\\r\\nif (!empty($toPlaceholder)) {\\r\\n    $modx->setPlaceholder($toPlaceholder, $output);\\r\\n} else {\\r\\n    return $output;\\r\\n}"}',
);