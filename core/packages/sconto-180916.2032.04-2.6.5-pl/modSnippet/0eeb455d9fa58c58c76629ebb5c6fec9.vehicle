<?php return array (
  'preserve_keys' => true,
  'update_object' => true,
  'vehicle_package' => 'transport',
  'vehicle_class' => 'xPDOObjectVehicle',
  'guid' => 'fee8e577a02b5e65c9d271568e755e4e',
  'package' => 'modx',
  'class' => 'modSnippet',
  'signature' => '0eeb455d9fa58c58c76629ebb5c6fec9',
  'native_key' => 49,
  'object' => '{"id":49,"source":1,"property_preprocess":0,"name":"mSearch2","description":"","editor_type":0,"category":13,"cache_type":0,"snippet":"\\/** @var modX $modx *\\/\\n\\/** @var array $scriptProperties *\\/\\n\\/** @var mSearch2 $mSearch2 *\\/\\nif (!$modx->loadClass(\'msearch2\', MODX_CORE_PATH . \'components\\/msearch2\\/model\\/msearch2\\/\', false, true)) {return false;}\\n$mSearch2 = new mSearch2($modx, $scriptProperties);\\n$mSearch2->pdoTools->setConfig($scriptProperties);\\n$mSearch2->pdoTools->addTime(\'pdoTools loaded.\');\\n\\nif (empty($queryVar)) {$queryVar = \'query\';}\\nif (empty($parentsVar)) {$parentsVar = \'parents\';}\\nif (empty($minQuery)) {$minQuery = $modx->getOption(\'index_min_words_length\', null, 3, true);}\\nif (empty($htagOpen)) {$htagOpen = \'<b>\';}\\nif (empty($htagClose)) {$htagClose = \'<\\/b>\';}\\nif (empty($outputSeparator)) {$outputSeparator = \\"\\\\n\\";}\\nif (empty($plPrefix)) {$plPrefix = \'mse2_\';}\\n$returnIds = !empty($returnIds);\\n$fastMode = !empty($fastMode);\\n\\n$class = \'modResource\';\\n$found = array();\\n$output = null;\\n$query = !empty($_REQUEST[$queryVar])\\n\\t? $mSearch2->getQuery(rawurldecode($_REQUEST[$queryVar]))\\n\\t: \'\';\\n\\nif (empty($resources)) {\\n\\tif (empty($query) && isset($_REQUEST[$queryVar])) {\\n\\t\\t$output = $modx->lexicon(\'mse2_err_no_query\');\\n\\t}\\n\\telseif (empty($query) && !empty($forceSearch)) {\\n\\t\\t$output = $modx->lexicon(\'mse2_err_no_query_var\');\\n\\t}\\n\\telseif (!empty($query) && !preg_match(\'\\/^[0-9]{2,}$\\/\', $query) && mb_strlen($query,\'UTF-8\') < $minQuery) {\\n\\t\\t$output = $modx->lexicon(\'mse2_err_min_query\');\\n\\t}\\n\\n\\t$modx->setPlaceholder($plPrefix.$queryVar, $query);\\n\\n\\tif (!empty($output)) {\\n\\t\\treturn !$returnIds\\n\\t\\t\\t? $output\\n\\t\\t\\t: \'\';\\n\\t}\\n\\telseif (!empty($query)) {\\n\\t\\t$found = $mSearch2->Search($query);\\n\\t\\t$ids = array_keys($found);\\n\\t\\t$resources = implode(\',\', $ids);\\n\\t\\tif (empty($found)) {\\n\\t\\t\\tif ($returnIds) {\\n\\t\\t\\t\\treturn \'\';\\n\\t\\t\\t}\\n\\t\\t\\telseif (!empty($query)) {\\n\\t\\t\\t\\t$output = $modx->lexicon(\'mse2_err_no_results\');\\n\\t\\t\\t}\\n\\t\\t\\tif (!empty($tplWrapper) && !empty($wrapIfEmpty)) {\\n\\t\\t\\t\\t$output = $mSearch2->pdoTools->getChunk(\\n\\t\\t\\t\\t\\t$tplWrapper,\\n\\t\\t\\t\\t\\tarray(\\n\\t\\t\\t\\t\\t\\t\'output\' => $output,\\n\\t\\t\\t\\t\\t\\t\'total\' => 0,\\n\\t\\t\\t\\t\\t\\t\'query\' => $query,\\n\\t\\t\\t\\t\\t\\t\'parents\' => $modx->getPlaceholder($plPrefix.$parentsVar),\\n\\t\\t\\t\\t\\t),\\n\\t\\t\\t\\t\\t$fastMode\\n\\t\\t\\t\\t);\\n\\t\\t\\t}\\n\\t\\t\\tif ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {\\n\\t\\t\\t\\t$output .= \'<pre class=\\"mSearchLog\\">\' . print_r($mSearch2->pdoTools->getTime(), 1) . \'<\\/pre>\';\\n\\t\\t\\t}\\n\\t\\t\\tif (!empty($toPlaceholder)) {\\n\\t\\t\\t\\t$modx->setPlaceholder($toPlaceholder, $output);\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\t\\t\\telse {\\n\\t\\t\\t\\treturn $output;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t}\\n}\\nelseif (strpos($resources, \'{\') === 0) {\\n\\t$found = $modx->fromJSON($resources);\\n\\t$resources = implode(\',\', array_keys($found));\\n\\tunset($scriptProperties[\'resources\']);\\n}\\n\\/*----------------------------------------------------------------------------------*\\/\\nif (empty($returnIds)) {\\n    \\/\\/ Joining tables\\n    $leftJoin = array(\\n        \'mseIntro\' => array(\\n            \'class\' => \'mseIntro\',\\n            \'alias\' => \'Intro\',\\n            \'on\' => $class . \'.id = Intro.resource\'\\n        )\\n    );\\n    \\/\\/ Fields to select\\n    $resourceColumns = !empty($includeContent)\\n        ? $modx->getSelectColumns($class, $class)\\n        : $modx->getSelectColumns($class, $class, \'\', array(\'content\'), true);\\n    $select = array(\\n        $class => $resourceColumns,\\n        \'Intro\' => \'intro\'\\n    );\\n    $groupby = $class.\'.id, Intro.intro\';\\n} else {\\n    $leftJoin = array();\\n    $select = array($class . \'id\');\\n    $groupby = $class.\'.id\';\\n}\\n\\n\\/\\/ Add custom parameters\\nforeach (array(\'leftJoin\', \'select\') as $v) {\\n    if (!empty($scriptProperties[$v])) {\\n        $tmp = $modx->fromJSON($scriptProperties[$v]);\\n        if (is_array($tmp)) {\\n            $$v = array_merge($$v, $tmp);\\n        }\\n    }\\n    unset($scriptProperties[$v]);\\n}\\n\\n\\/\\/ Default parameters\\n$default = array(\\n\\t\'class\' => $class,\\n\\t\'leftJoin\' => $leftJoin,\\n\\t\'select\' => $select,\\n\\t\'groupby\' => $groupby,\\n\\t\'return\' => !empty($returnIds)\\n\\t\\t? \'ids\'\\n\\t\\t: \'data\',\\n    \'fastMode\' => $fastMode,\\n    \'nestedChunkPrefix\' => \'msearch2_\',\\n);\\nif (!empty($resources)) {\\n\\t$default[\'resources\'] = is_array($resources)\\n\\t\\t? implode(\',\', $resources)\\n\\t\\t: $resources;\\n}\\n\\n\\/\\/ Merge all properties and run!\\n$mSearch2->pdoTools->setConfig(array_merge($default, $scriptProperties), false);\\n$mSearch2->pdoTools->addTime(\'Query parameters are prepared.\');\\n$rows = $mSearch2->pdoTools->run();\\n\\n$log = \'\';\\nif ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {\\n\\t$log .= \'<pre class=\\"mSearchLog\\">\' . print_r($mSearch2->pdoTools->getTime(), 1) . \'<\\/pre>\';\\n}\\n\\n\\/\\/ Processing results\\nif (!empty($returnIds)) {\\n\\t$modx->setPlaceholder(\'mSearch.log\', $log);\\n\\tif (!empty($toPlaceholder)) {\\n\\t\\t$modx->setPlaceholder($toPlaceholder, $rows);\\n\\t\\treturn \'\';\\n\\t}\\n\\telse {\\n\\t\\treturn $rows;\\n\\t}\\n}\\nelseif (!empty($rows) && is_array($rows)) {\\n\\t$output = array();\\n\\tforeach ($rows as $k => $row) {\\n\\t\\t\\/\\/ Processing main fields\\n\\t\\t$row[\'weight\'] = isset($found[$row[\'id\']]) ? $found[$row[\'id\']] : \'\';\\n\\t\\t$row[\'intro\'] = $mSearch2->Highlight($row[\'intro\'], $query, $htagOpen, $htagClose);\\n\\n\\t\\t$row[\'idx\'] = $mSearch2->pdoTools->idx++;\\n\\t\\t$tplRow = $mSearch2->pdoTools->defineChunk($row);\\n\\t\\t$output[] .= empty($tplRow)\\n\\t\\t\\t? $mSearch2->pdoTools->getChunk(\'\', $row)\\n\\t\\t\\t: $mSearch2->pdoTools->getChunk($tplRow, $row, $fastMode);\\n\\t}\\n\\t$mSearch2->pdoTools->addTime(\'Returning processed chunks\');\\n\\tif (!empty($toSeparatePlaceholders)) {\\n\\t\\t$output[\'log\'] = $log;\\n\\t\\t$modx->setPlaceholders($output, $toSeparatePlaceholders);\\n\\t}\\n\\telse {\\n\\t\\t$output = implode($outputSeparator, $output) . $log;\\n\\t}\\n}\\nelse {\\n\\t$output = $modx->lexicon(\'mse2_err_no_results\') . $log;\\n}\\n\\n\\/\\/ Return output\\nif (!empty($tplWrapper) && (!empty($wrapIfEmpty) || !empty($output))) {\\n\\t$output = $mSearch2->pdoTools->getChunk(\\n\\t\\t$tplWrapper,\\n\\t\\tarray(\\n\\t\\t\\t\'output\' => $output,\\n\\t\\t\\t\'total\' => $modx->getPlaceholder($mSearch2->pdoTools->config[\'totalVar\']),\\n\\t\\t\\t\'query\' => $modx->getPlaceholder($plPrefix.$queryVar),\\n\\t\\t\\t\'parents\' => $modx->getPlaceholder($plPrefix.$parentsVar),\\n\\t\\t),\\n\\t\\t$fastMode\\n\\t);\\n}\\n\\nif (!empty($toPlaceholder)) {\\n\\t$modx->setPlaceholder($toPlaceholder, $output);\\n}\\nelse {\\n\\treturn $output;\\n}","locked":0,"properties":"a:32:{s:3:\\"tpl\\";a:7:{s:4:\\"name\\";s:3:\\"tpl\\";s:4:\\"desc\\";s:13:\\"mse2_prop_tpl\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:16:\\"tpl.mSearch2.row\\";s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:9:\\"returnIds\\";a:7:{s:4:\\"name\\";s:9:\\"returnIds\\";s:4:\\"desc\\";s:19:\\"mse2_prop_returnIds\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:7:\\"showLog\\";a:7:{s:4:\\"name\\";s:7:\\"showLog\\";s:4:\\"desc\\";s:17:\\"mse2_prop_showLog\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:8:\\"fastMode\\";a:7:{s:4:\\"name\\";s:8:\\"fastMode\\";s:4:\\"desc\\";s:18:\\"mse2_prop_fastMode\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:5:\\"limit\\";a:7:{s:4:\\"name\\";s:5:\\"limit\\";s:4:\\"desc\\";s:15:\\"mse2_prop_limit\\";s:4:\\"type\\";s:11:\\"numberfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";i:10;s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:6:\\"offset\\";a:7:{s:4:\\"name\\";s:6:\\"offset\\";s:4:\\"desc\\";s:16:\\"mse2_prop_offset\\";s:4:\\"type\\";s:11:\\"numberfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";i:0;s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:5:\\"depth\\";a:7:{s:4:\\"name\\";s:5:\\"depth\\";s:4:\\"desc\\";s:15:\\"mse2_prop_depth\\";s:4:\\"type\\";s:11:\\"numberfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";i:10;s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:15:\\"outputSeparator\\";a:7:{s:4:\\"name\\";s:15:\\"outputSeparator\\";s:4:\\"desc\\";s:25:\\"mse2_prop_outputSeparator\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:1:\\"\\n\\";s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:13:\\"toPlaceholder\\";a:7:{s:4:\\"name\\";s:13:\\"toPlaceholder\\";s:4:\\"desc\\";s:23:\\"mse2_prop_toPlaceholder\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:22:\\"toSeparatePlaceholders\\";a:7:{s:4:\\"name\\";s:22:\\"toSeparatePlaceholders\\";s:4:\\"desc\\";s:32:\\"mse2_prop_toSeparatePlaceholders\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:7:\\"parents\\";a:7:{s:4:\\"name\\";s:7:\\"parents\\";s:4:\\"desc\\";s:17:\\"mse2_prop_parents\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:10:\\"includeTVs\\";a:7:{s:4:\\"name\\";s:10:\\"includeTVs\\";s:4:\\"desc\\";s:20:\\"mse2_prop_includeTVs\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:8:\\"tvPrefix\\";a:7:{s:4:\\"name\\";s:8:\\"tvPrefix\\";s:4:\\"desc\\";s:18:\\"mse2_prop_tvPrefix\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:5:\\"where\\";a:7:{s:4:\\"name\\";s:5:\\"where\\";s:4:\\"desc\\";s:15:\\"mse2_prop_where\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:15:\\"showUnpublished\\";a:7:{s:4:\\"name\\";s:15:\\"showUnpublished\\";s:4:\\"desc\\";s:25:\\"mse2_prop_showUnpublished\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:11:\\"showDeleted\\";a:7:{s:4:\\"name\\";s:11:\\"showDeleted\\";s:4:\\"desc\\";s:21:\\"mse2_prop_showDeleted\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:10:\\"showHidden\\";a:7:{s:4:\\"name\\";s:10:\\"showHidden\\";s:4:\\"desc\\";s:20:\\"mse2_prop_showHidden\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:1;s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:14:\\"hideContainers\\";a:7:{s:4:\\"name\\";s:14:\\"hideContainers\\";s:4:\\"desc\\";s:24:\\"mse2_prop_hideContainers\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:14:\\"introCutBefore\\";a:7:{s:4:\\"name\\";s:14:\\"introCutBefore\\";s:4:\\"desc\\";s:24:\\"mse2_prop_introCutBefore\\";s:4:\\"type\\";s:11:\\"numberfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";i:50;s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:13:\\"introCutAfter\\";a:7:{s:4:\\"name\\";s:13:\\"introCutAfter\\";s:4:\\"desc\\";s:23:\\"mse2_prop_introCutAfter\\";s:4:\\"type\\";s:11:\\"numberfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";i:250;s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:8:\\"htagOpen\\";a:7:{s:4:\\"name\\";s:8:\\"htagOpen\\";s:4:\\"desc\\";s:18:\\"mse2_prop_htagOpen\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:3:\\"<b>\\";s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:9:\\"htagClose\\";a:7:{s:4:\\"name\\";s:9:\\"htagClose\\";s:4:\\"desc\\";s:19:\\"mse2_prop_htagClose\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:4:\\"<\\/b>\\";s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:10:\\"parentsVar\\";a:7:{s:4:\\"name\\";s:10:\\"parentsVar\\";s:4:\\"desc\\";s:20:\\"mse2_prop_parentsVar\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:7:\\"parents\\";s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:8:\\"queryVar\\";a:7:{s:4:\\"name\\";s:8:\\"queryVar\\";s:4:\\"desc\\";s:18:\\"mse2_prop_queryVar\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:5:\\"query\\";s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:10:\\"tplWrapper\\";a:7:{s:4:\\"name\\";s:10:\\"tplWrapper\\";s:4:\\"desc\\";s:20:\\"mse2_prop_tplWrapper\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:11:\\"wrapIfEmpty\\";a:7:{s:4:\\"name\\";s:11:\\"wrapIfEmpty\\";s:4:\\"desc\\";s:21:\\"mse2_prop_wrapIfEmpty\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:11:\\"forceSearch\\";a:7:{s:4:\\"name\\";s:11:\\"forceSearch\\";s:4:\\"desc\\";s:21:\\"mse2_prop_forceSearch\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:1;s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:8:\\"minQuery\\";a:7:{s:4:\\"name\\";s:8:\\"minQuery\\";s:4:\\"desc\\";s:18:\\"mse2_prop_minQuery\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";i:3;s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:6:\\"fields\\";a:7:{s:4:\\"name\\";s:6:\\"fields\\";s:4:\\"desc\\";s:16:\\"mse2_prop_fields\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:9:\\"onlyIndex\\";a:7:{s:4:\\"name\\";s:9:\\"onlyIndex\\";s:4:\\"desc\\";s:19:\\"mse2_prop_onlyIndex\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:12:\\"onlyAllWords\\";a:7:{s:4:\\"name\\";s:12:\\"onlyAllWords\\";s:4:\\"desc\\";s:22:\\"mse2_prop_onlyAllWords\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:13:\\"showSearchLog\\";a:7:{s:4:\\"name\\";s:13:\\"showSearchLog\\";s:4:\\"desc\\";s:23:\\"mse2_prop_showSearchLog\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";a:0:{}s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:19:\\"msearch2:properties\\";s:4:\\"area\\";s:0:\\"\\";}}","moduleguid":"","static":0,"static_file":"core\\/components\\/msearch2\\/elements\\/snippets\\/snippet.msearch2.php","content":"\\/** @var modX $modx *\\/\\n\\/** @var array $scriptProperties *\\/\\n\\/** @var mSearch2 $mSearch2 *\\/\\nif (!$modx->loadClass(\'msearch2\', MODX_CORE_PATH . \'components\\/msearch2\\/model\\/msearch2\\/\', false, true)) {return false;}\\n$mSearch2 = new mSearch2($modx, $scriptProperties);\\n$mSearch2->pdoTools->setConfig($scriptProperties);\\n$mSearch2->pdoTools->addTime(\'pdoTools loaded.\');\\n\\nif (empty($queryVar)) {$queryVar = \'query\';}\\nif (empty($parentsVar)) {$parentsVar = \'parents\';}\\nif (empty($minQuery)) {$minQuery = $modx->getOption(\'index_min_words_length\', null, 3, true);}\\nif (empty($htagOpen)) {$htagOpen = \'<b>\';}\\nif (empty($htagClose)) {$htagClose = \'<\\/b>\';}\\nif (empty($outputSeparator)) {$outputSeparator = \\"\\\\n\\";}\\nif (empty($plPrefix)) {$plPrefix = \'mse2_\';}\\n$returnIds = !empty($returnIds);\\n$fastMode = !empty($fastMode);\\n\\n$class = \'modResource\';\\n$found = array();\\n$output = null;\\n$query = !empty($_REQUEST[$queryVar])\\n\\t? $mSearch2->getQuery(rawurldecode($_REQUEST[$queryVar]))\\n\\t: \'\';\\n\\nif (empty($resources)) {\\n\\tif (empty($query) && isset($_REQUEST[$queryVar])) {\\n\\t\\t$output = $modx->lexicon(\'mse2_err_no_query\');\\n\\t}\\n\\telseif (empty($query) && !empty($forceSearch)) {\\n\\t\\t$output = $modx->lexicon(\'mse2_err_no_query_var\');\\n\\t}\\n\\telseif (!empty($query) && !preg_match(\'\\/^[0-9]{2,}$\\/\', $query) && mb_strlen($query,\'UTF-8\') < $minQuery) {\\n\\t\\t$output = $modx->lexicon(\'mse2_err_min_query\');\\n\\t}\\n\\n\\t$modx->setPlaceholder($plPrefix.$queryVar, $query);\\n\\n\\tif (!empty($output)) {\\n\\t\\treturn !$returnIds\\n\\t\\t\\t? $output\\n\\t\\t\\t: \'\';\\n\\t}\\n\\telseif (!empty($query)) {\\n\\t\\t$found = $mSearch2->Search($query);\\n\\t\\t$ids = array_keys($found);\\n\\t\\t$resources = implode(\',\', $ids);\\n\\t\\tif (empty($found)) {\\n\\t\\t\\tif ($returnIds) {\\n\\t\\t\\t\\treturn \'\';\\n\\t\\t\\t}\\n\\t\\t\\telseif (!empty($query)) {\\n\\t\\t\\t\\t$output = $modx->lexicon(\'mse2_err_no_results\');\\n\\t\\t\\t}\\n\\t\\t\\tif (!empty($tplWrapper) && !empty($wrapIfEmpty)) {\\n\\t\\t\\t\\t$output = $mSearch2->pdoTools->getChunk(\\n\\t\\t\\t\\t\\t$tplWrapper,\\n\\t\\t\\t\\t\\tarray(\\n\\t\\t\\t\\t\\t\\t\'output\' => $output,\\n\\t\\t\\t\\t\\t\\t\'total\' => 0,\\n\\t\\t\\t\\t\\t\\t\'query\' => $query,\\n\\t\\t\\t\\t\\t\\t\'parents\' => $modx->getPlaceholder($plPrefix.$parentsVar),\\n\\t\\t\\t\\t\\t),\\n\\t\\t\\t\\t\\t$fastMode\\n\\t\\t\\t\\t);\\n\\t\\t\\t}\\n\\t\\t\\tif ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {\\n\\t\\t\\t\\t$output .= \'<pre class=\\"mSearchLog\\">\' . print_r($mSearch2->pdoTools->getTime(), 1) . \'<\\/pre>\';\\n\\t\\t\\t}\\n\\t\\t\\tif (!empty($toPlaceholder)) {\\n\\t\\t\\t\\t$modx->setPlaceholder($toPlaceholder, $output);\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\t\\t\\telse {\\n\\t\\t\\t\\treturn $output;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t}\\n}\\nelseif (strpos($resources, \'{\') === 0) {\\n\\t$found = $modx->fromJSON($resources);\\n\\t$resources = implode(\',\', array_keys($found));\\n\\tunset($scriptProperties[\'resources\']);\\n}\\n\\/*----------------------------------------------------------------------------------*\\/\\nif (empty($returnIds)) {\\n    \\/\\/ Joining tables\\n    $leftJoin = array(\\n        \'mseIntro\' => array(\\n            \'class\' => \'mseIntro\',\\n            \'alias\' => \'Intro\',\\n            \'on\' => $class . \'.id = Intro.resource\'\\n        )\\n    );\\n    \\/\\/ Fields to select\\n    $resourceColumns = !empty($includeContent)\\n        ? $modx->getSelectColumns($class, $class)\\n        : $modx->getSelectColumns($class, $class, \'\', array(\'content\'), true);\\n    $select = array(\\n        $class => $resourceColumns,\\n        \'Intro\' => \'intro\'\\n    );\\n    $groupby = $class.\'.id, Intro.intro\';\\n} else {\\n    $leftJoin = array();\\n    $select = array($class . \'id\');\\n    $groupby = $class.\'.id\';\\n}\\n\\n\\/\\/ Add custom parameters\\nforeach (array(\'leftJoin\', \'select\') as $v) {\\n    if (!empty($scriptProperties[$v])) {\\n        $tmp = $modx->fromJSON($scriptProperties[$v]);\\n        if (is_array($tmp)) {\\n            $$v = array_merge($$v, $tmp);\\n        }\\n    }\\n    unset($scriptProperties[$v]);\\n}\\n\\n\\/\\/ Default parameters\\n$default = array(\\n\\t\'class\' => $class,\\n\\t\'leftJoin\' => $leftJoin,\\n\\t\'select\' => $select,\\n\\t\'groupby\' => $groupby,\\n\\t\'return\' => !empty($returnIds)\\n\\t\\t? \'ids\'\\n\\t\\t: \'data\',\\n    \'fastMode\' => $fastMode,\\n    \'nestedChunkPrefix\' => \'msearch2_\',\\n);\\nif (!empty($resources)) {\\n\\t$default[\'resources\'] = is_array($resources)\\n\\t\\t? implode(\',\', $resources)\\n\\t\\t: $resources;\\n}\\n\\n\\/\\/ Merge all properties and run!\\n$mSearch2->pdoTools->setConfig(array_merge($default, $scriptProperties), false);\\n$mSearch2->pdoTools->addTime(\'Query parameters are prepared.\');\\n$rows = $mSearch2->pdoTools->run();\\n\\n$log = \'\';\\nif ($modx->user->hasSessionContext(\'mgr\') && !empty($showLog)) {\\n\\t$log .= \'<pre class=\\"mSearchLog\\">\' . print_r($mSearch2->pdoTools->getTime(), 1) . \'<\\/pre>\';\\n}\\n\\n\\/\\/ Processing results\\nif (!empty($returnIds)) {\\n\\t$modx->setPlaceholder(\'mSearch.log\', $log);\\n\\tif (!empty($toPlaceholder)) {\\n\\t\\t$modx->setPlaceholder($toPlaceholder, $rows);\\n\\t\\treturn \'\';\\n\\t}\\n\\telse {\\n\\t\\treturn $rows;\\n\\t}\\n}\\nelseif (!empty($rows) && is_array($rows)) {\\n\\t$output = array();\\n\\tforeach ($rows as $k => $row) {\\n\\t\\t\\/\\/ Processing main fields\\n\\t\\t$row[\'weight\'] = isset($found[$row[\'id\']]) ? $found[$row[\'id\']] : \'\';\\n\\t\\t$row[\'intro\'] = $mSearch2->Highlight($row[\'intro\'], $query, $htagOpen, $htagClose);\\n\\n\\t\\t$row[\'idx\'] = $mSearch2->pdoTools->idx++;\\n\\t\\t$tplRow = $mSearch2->pdoTools->defineChunk($row);\\n\\t\\t$output[] .= empty($tplRow)\\n\\t\\t\\t? $mSearch2->pdoTools->getChunk(\'\', $row)\\n\\t\\t\\t: $mSearch2->pdoTools->getChunk($tplRow, $row, $fastMode);\\n\\t}\\n\\t$mSearch2->pdoTools->addTime(\'Returning processed chunks\');\\n\\tif (!empty($toSeparatePlaceholders)) {\\n\\t\\t$output[\'log\'] = $log;\\n\\t\\t$modx->setPlaceholders($output, $toSeparatePlaceholders);\\n\\t}\\n\\telse {\\n\\t\\t$output = implode($outputSeparator, $output) . $log;\\n\\t}\\n}\\nelse {\\n\\t$output = $modx->lexicon(\'mse2_err_no_results\') . $log;\\n}\\n\\n\\/\\/ Return output\\nif (!empty($tplWrapper) && (!empty($wrapIfEmpty) || !empty($output))) {\\n\\t$output = $mSearch2->pdoTools->getChunk(\\n\\t\\t$tplWrapper,\\n\\t\\tarray(\\n\\t\\t\\t\'output\' => $output,\\n\\t\\t\\t\'total\' => $modx->getPlaceholder($mSearch2->pdoTools->config[\'totalVar\']),\\n\\t\\t\\t\'query\' => $modx->getPlaceholder($plPrefix.$queryVar),\\n\\t\\t\\t\'parents\' => $modx->getPlaceholder($plPrefix.$parentsVar),\\n\\t\\t),\\n\\t\\t$fastMode\\n\\t);\\n}\\n\\nif (!empty($toPlaceholder)) {\\n\\t$modx->setPlaceholder($toPlaceholder, $output);\\n}\\nelse {\\n\\treturn $output;\\n}"}',
);